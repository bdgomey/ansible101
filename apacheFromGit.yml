# setup webservers
---
  - hosts: webservers
    become: true
    vars_files:
      vars.yaml

    tasks:
      - name: update all packages to the latest version
        package: 
          name: "*" 
          state: latest


      - name: install apache webserver
        package: 
          name: apache2 
          state: present
      
      - name: install git
        package:
          name: git
          state: present

      - name: delete original index.html file
        file: 
          path: /var/www/html/index.html 
          state: absent

      - name: Create a directory for github to use
        file:
          path: /var/www/github
          state: directory

      - name: clean folder if it exists
        command: rm -rf /var/www/github
        ignore_errors: yes

      - name: download github repository
        git:
          repo: 'https://github.com/bdgomey/ansible101.git'
          dest: /var/www/github

      - name: copy index.html into the /var/www/html folder
        command: mv /var/www/github/index.html /var/www/html
        notify: start apache

    handlers:
      - name: start apache
        service: 
          name: apache2 
          state: started
